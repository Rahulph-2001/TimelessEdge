<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= user.first_name %>'s TimelessEdge
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- SweetAlert2 CSS and JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .sticky-sidebar {
            position: sticky;
            top: 20px;
        }

        .section-card {
            transition: all 0.3s ease;
        }

        .section-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .nav-link {
            transition: all 0.2s ease;
        }


        .nav-link.active {
            background-color: #4F46E5;
            color: white;
        }

        .address-card {
            position: relative;
        }

        .address-card .absolute.top-4.right-4 {
            z-index: 10;
        }

        .address-card button {
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #e5e7eb;
            padding: 0.25rem;
            border-radius: 9999px;
            transition: all 0.2s ease;
        }

        .address-card button:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>

<body class="bg-gray-50">
    <%- include("../../views/partials/user/header") %>

        <main class="container mx-auto px-4 py-8 pt-20">
            <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center md:text-left">My Account</h1>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Sidebar Navigation -->
                <aside class="w-full lg:w-1/4">
                    <div class="bg-white shadow-md rounded-xl p-6 sticky-sidebar">
                        <div class="flex items-center space-x-4 mb-8 pb-6 border-b border-gray-100">
                            <div class="relative">
                                <img src="<%= user.profile_image || '/ui/dprofile.jpg' %>" alt="User Avatar"
                                    class="w-16 h-16 rounded-full object-cover border-2 border-indigo-500">
                            </div>
                            <div>
                                <h2 class="text-xl font-semibold text-gray-800">
                                    <%= user.name %>
                                </h2>
                                <p class="text-gray-600 text-sm">
                                    <%= user.email %>
                                </p>
                            </div>
                        </div>
                        <nav>
                            <ul class="space-y-2">
                                <li>
                                    <a href="#overview"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i data-lucide="user" class="w-5 h-5"></i>
                                        <span>Account Overview</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/profile/edit"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i data-lucide="edit" class="w-5 h-5"></i>
                                        <span>Edit Profile</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/wallet"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i class="fa-solid fa-wallet"></i>
                                        <span>Wallet</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#referrals"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i data-lucide="users" class="w-5 h-5"></i>
                                        <span>My Referrals</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/change-Email"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i class="fa-solid fa-envelope-open-text"></i>
                                        <span>Change Email</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/change-password"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i data-lucide="key" class="w-5 h-5"></i>
                                        <span>Change Password</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#orders"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i data-lucide="package" class="w-5 h-5"></i>
                                        <span>My Orders</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#addresses"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                                        <span>Manage Addresses</span>
                                    </a>
                                </li>
                                <li class="pt-4 mt-4 border-t border-gray-100">
                                    <a href="/logout"
                                        class="nav-link flex items-center space-x-3 p-3 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700">
                                        <i data-lucide="log-out" class="w-5 h-5"></i>
                                        <span>Logout</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </aside>

                <!-- Main Content Area -->
                <div class="w-full lg:w-3/4">
                    <!-- Account Overview Section -->
                    <section id="overview" class="mb-10 section-card">
                        <div class="bg-white shadow-md rounded-xl p-6">
                            <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
                                <i data-lucide="user" class="w-6 h-6 mr-2 text-indigo-600"></i>
                                Account Overview
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <h3 class="text-lg font-medium mb-4 text-gray-700">Personal Information</h3>
                                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                                        <p class="mb-3 flex items-center">
                                            <span class="font-semibold text-gray-700 w-32">Name:</span>
                                            <span class="text-gray-800">
                                                <%= user.name %>
                                            </span>
                                        </p>
                                        <p class="mb-3 flex items-center">
                                            <span class="font-semibold text-gray-700 w-32">Email:</span>
                                            <span class="text-gray-800">
                                                <%= user.email %>
                                            </span>
                                        </p>
                                        <p class="mb-3 flex items-center">
                                            <span class="font-semibold text-gray-700 w-32">Mobile:</span>
                                            <span class="text-gray-800">
                                                <%= user.phone || 'Not provided' %>
                                            </span>
                                        </p>
                                        <p class="flex items-center">
                                            <span class="font-semibold text-gray-700 w-32">Account Status:</span>
                                            <span
                                                class="<%= user.isBlocked ? 'text-red-600' : 'text-green-600' %> font-medium">
                                                <%= user.isBlocked ? 'Inactive' : 'Active' %>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium mb-4 text-gray-700">Account Details</h3>
                                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                                        <p class="mb-3 flex items-center">
                                            <span class="font-semibold text-gray-700 w-32">Account Type:</span>
                                            <span
                                                class="<%= user.googleId ? 'text-blue-600' : 'text-gray-800' %> font-medium">
                                                <%= user.googleId ? 'Google Account' : 'Email Account' %>
                                            </span>
                                        </p>
                                        <p class="mb-3 flex items-center">
                                            <span class="font-semibold text-gray-700 w-32">Member Since:</span>
                                            <span class="text-gray-800">
                                                <%= user.createdOn ? new Date(user.createdOn).toLocaleDateString()
                                                    : 'Unknown' %>
                                            </span>
                                        </p>
                                       
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Orders Section -->
                    <section id="orders" class="mb-10 section-card">
                        <div class="bg-white shadow-md rounded-xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-semibold text-gray-800 flex items-center">
                                    <i data-lucide="package" class="w-6 h-6 mr-2 text-indigo-600"></i>
                                    My Orders
                                </h2>
                              
                            </div>
                            <% if (orders && orders.length> 0) { %>
                                <div class="overflow-x-auto rounded-lg border border-gray-200">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th
                                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Order ID</th>
                                                <th
                                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Date</th>
                                                <th
                                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Total</th>
                                                <th
                                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Status</th>
                                                <th
                                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            <% orders.forEach(order=> { %>
                                                <tr class="hover:bg-gray-50 order-row"
                                                    data-status="<%= order.status.toLowerCase() %>">
                                                    <td
                                                        class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                        #<%= order.orderId %>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        <%= new Date(order.createdOn).toLocaleDateString() %>
                                                    </td>
                                                    <td
                                                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
                                                        Rs:<%= order.totalPrice %>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                    <%= order.status === 'Delivered' ? 'bg-green-100 text-green-800' : 
                                    order.status === 'Processing' ? 'bg-blue-100 text-blue-800' : 
                                    order.status === 'Paid' ? 'bg-indigo-100 text-indigo-800' : 
                                    order.status === 'Shipped' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-red-100 text-red-800' %>">
                                                            <%= order.status %>
                                                        </span>
                                                    </td>
                                                    <td
                                                        class="px-6 py-4 whitespace-nowrap text-sm flex items-center space-x-2">
                                                        <a href="/orders/<%= order._id %>"
                                                            class="inline-flex items-center text-indigo-600 hover:text-indigo-900 font-medium px-3 py-1 rounded hover:bg-indigo-50">
                                                            <i data-lucide="eye" class="w-4 h-4 mr-1"></i>
                                                            View
                                                        </a>
                                                       
                                                    </td>
                                                </tr>
                                                <% }) %>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Order Summary Cards for Mobile -->
                                <div class="md:hidden space-y-4 mt-4">
                                    <% orders.forEach(order=> { %>
                                        <div class="bg-white border rounded-lg shadow-sm p-4 order-card"
                                            data-status="<%= order.status.toLowerCase() %>">
                                            <div class="flex justify-between items-start mb-3">
                                                <div>
                                                    <span class="text-xs text-gray-500">Order ID</span>
                                                    <h3 class="font-medium">#<%= order.orderId %>
                                                    </h3>
                                                </div>
                                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                            <%= order.status === 'Delivered' ? 'bg-green-100 text-green-800' : 
                            order.status === 'Processing' ? 'bg-blue-100 text-blue-800' : 
                            order.status === 'Paid' ? 'bg-indigo-100 text-indigo-800' : 
                            order.status === 'Shipped' ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-red-100 text-red-800' %>">
                                                    <%= order.status %>
                                                </span>
                                            </div>
                                            <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
                                                <div>
                                                    <span class="text-xs text-gray-500">Date</span>
                                                    <p>
                                                        <%= new Date(order.createdOn).toLocaleDateString() %>
                                                    </p>
                                                </div>
                                                <div>
                                                    <span class="text-xs text-gray-500">Total</span>
                                                    <p class="font-medium">Rs:<%= order.totalPrice %>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2 pt-2 border-t border-gray-100">
                                                <a href="/orders/<%= order._id %>"
                                                    class="flex-1 inline-flex justify-center items-center text-indigo-600 hover:text-indigo-900 font-medium py-2 rounded hover:bg-indigo-50">
                                                    <i data-lucide="eye" class="w-4 h-4 mr-1"></i>
                                                    View
                                                </a>
                                                <% if (order.status==='Processing' || order.status==='Pending' ) { %>
                                                    <button onclick="cancelOrder('<%= order._id %>')"
                                                        class="flex-1 inline-flex justify-center items-center text-red-600 hover:text-red-900 font-medium py-2 rounded hover:bg-red-50">
                                                        <i data-lucide="x-circle" class="w-4 h-4 mr-1"></i>
                                                        Cancel
                                                    </button>
                                                    <% } else { %>
                                                        <div class="flex-1"></div>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <% }) %>
                                </div>

                                <!-- Pagination Controls -->
                                <% if (pagination && pagination.totalPages> 1) { %>
                                    <div
                                        class="px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 mt-4">
                                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                            <div>
                                                <p class="text-sm text-gray-700">
                                                    Showing
                                                    <span class="font-medium">
                                                        <%= (pagination.page - 1) * pagination.limit + 1 %>
                                                    </span>
                                                    to
                                                    <span class="font-medium">
                                                        <%= Math.min(pagination.page * pagination.limit,
                                                            pagination.totalOrders) %>
                                                    </span>
                                                    of
                                                    <span class="font-medium">
                                                        <%= pagination.totalOrders %>
                                                    </span>
                                                    orders
                                                </p>
                                            </div>
                                            <div>
                                                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"
                                                    aria-label="Pagination">
                                                    <!-- Previous Page Button -->
                                                    <a href="<%= pagination.page > 1 ? '?page=' + (pagination.page - 1) : '#' %>"
                                                        class="<%= pagination.page <= 1 ? 'cursor-not-allowed bg-gray-100' : 'hover:bg-gray-50' %> relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500">
                                                        <span class="sr-only">Previous</span>
                                                        <i data-lucide="chevron-left" class="h-5 w-5"></i>
                                                    </a>

                                                    <!-- Page Numbers -->
                                                    <% for(let i=1; i <=pagination.totalPages; i++) { %>
                                                        <a href="?page=<%= i %>"
                                                            class="<%= pagination.page === i ? 'z-10 bg-indigo-50 border-indigo-500 text-indigo-600' : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50' %> relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                                                            <%= i %>
                                                        </a>
                                                        <% } %>

                                                            <!-- Next Page Button -->
                                                            <a href="<%= pagination.page < pagination.totalPages ? '?page=' + (pagination.page + 1) : '#' %>"
                                                                class="<%= pagination.page >= pagination.totalPages ? 'cursor-not-allowed bg-gray-100' : 'hover:bg-gray-50' %> relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500">
                                                                <span class="sr-only">Next</span>
                                                                <i data-lucide="chevron-right" class="h-5 w-5"></i>
                                                            </a>
                                                </nav>
                                            </div>
                                        </div>
                                        <!-- Mobile Pagination -->
                                        <div class="flex justify-between items-center sm:hidden mt-4">
                                            <a href="<%= pagination.page > 1 ? '?page=' + (pagination.page - 1) : '#' %>"
                                                class="<%= pagination.page <= 1 ? 'opacity-50 cursor-not-allowed' : '' %> relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                                Previous
                                            </a>
                                            <span class="text-sm text-gray-700">
                                                Page <%= pagination.page %> of <%= pagination.totalPages %>
                                            </span>
                                            <a href="<%= pagination.page < pagination.totalPages ? '?page=' + (pagination.page + 1) : '#' %>"
                                                class="<%= pagination.page >= pagination.totalPages ? 'opacity-50 cursor-not-allowed' : '' %> ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                                Next
                                            </a>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } else { %>
                                            <div class="text-center py-12 bg-gray-50 rounded-lg border border-gray-200">
                                                <i data-lucide="package"
                                                    class="w-12 h-12 mx-auto text-gray-400 mb-4"></i>
                                                <p class="text-gray-600">No orders found.</p>
                                                <a href="/"
                                                    class="mt-4 inline-block px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Start
                                                    Shopping</a>
                                            </div>
                                            <% } %>
                        </div>
                    </section>

                    <!-- Addresses Section -->
                    <section id="addresses" class="mb-10 section-card">
                        <div class="bg-white shadow-md rounded-xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-semibold text-gray-800 flex items-center">
                                    <i data-lucide="map-pin" class="w-6 h-6 mr-2 text-indigo-600"></i>
                                    Manage Addresses
                                </h2>
                                <button onclick="window.location.href='/profile/address/add'"
                                    class="inline-flex items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                    Add New Address
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <% if (addresses && addresses.length> 0) { %>
                                    <% addresses.forEach(doc=> { %>
                                        <% if (doc.address && doc.address.length> 0) { %>
                                            <% doc.address.forEach(address=> { %>
                                                <div
                                                    class="address-card rounded-lg p-5 relative hover:shadow-md <%= address.isBlocked ? 'bg-gray-100 border-gray-300' : '' %>">
                                                    <% if (address.isBlocked) { %>
                                                        <div
                                                            class="absolute top-0 left-0 w-full h-full bg-gray-200 bg-opacity-30 rounded-lg pointer-events-none">
                                                        </div>
                                                        <div class="absolute top-2 right-2">
                                                            <span
                                                                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                                Blocked
                                                            </span>
                                                        </div>
                                                        <% } %>
                                                            <div class="absolute top-4 right-4 space-x-2 flex z-10">
                                                                <button
                                                                    onclick="window.location.href='/profile/address/edit/<%= address._id %>'"
                                                                    class="text-indigo-600 hover:text-indigo-900 p-1 rounded-full"
                                                                    title="Edit Address">
                                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                                </button>

                                                                <% if (address.isBlocked) { %>
                                                                    <button
                                                                        onclick="unblockAddress('<%= doc._id %>', '<%= address._id %>')"
                                                                        class="text-green-600 hover:text-green-900 p-1 rounded-full"
                                                                        title="Unblock Address">
                                                                        <i data-lucide="unlock" class="w-4 h-4"></i>
                                                                    </button>
                                                                    <% } else { %>
                                                                        <button
                                                                            onclick="blockAddress('<%= doc._id %>', '<%= address._id %>')"
                                                                            class="text-yellow-600 hover:text-yellow-900 p-1 rounded-full"
                                                                            title="Block Address">
                                                                            <i data-lucide="lock" class="w-4 h-4"></i>
                                                                        </button>
                                                                        <% } %>
                                                            </div>
                                                            <div class="mb-4">
                                                                <span
                                                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= address.isBlocked ? 'bg-gray-100 text-gray-600' : 'bg-indigo-100 text-indigo-800' %>">
                                                                    <%= address.adressType || 'Address' %>
                                                                </span>
                                                            </div>
                                                            <h3
                                                                class="font-medium text-lg mb-2 pr-16 <%= address.isBlocked ? 'text-gray-500' : 'text-gray-800' %>">
                                                                <%= address.name %>
                                                            </h3>
                                                            <p
                                                                class="<%= address.isBlocked ? 'text-gray-500' : 'text-gray-600' %> mb-1 flex items-start">
                                                                <i data-lucide="map-pin"
                                                                    class="w-4 h-4 mr-2 mt-1 flex-shrink-0"></i>
                                                                <span>
                                                                    <%= address.landMark %>, <%= address.city %>, <%=
                                                                                address.state %>
                                                                </span>
                                                            </p>
                                                            <p
                                                                class="<%= address.isBlocked ? 'text-gray-500' : 'text-gray-600' %> mb-1 flex items-center">
                                                                <i data-lucide="hash"
                                                                    class="w-4 h-4 mr-2 flex-shrink-0"></i>
                                                                <span>PIN: <%= address.pincode %></span>
                                                            </p>
                                                            <p
                                                                class="<%= address.isBlocked ? 'text-gray-500' : 'text-gray-600' %> flex items-center">
                                                                <i data-lucide="phone"
                                                                    class="w-4 h-4 mr-2 flex-shrink-0"></i>
                                                                <span>
                                                                    <%= address.phone %>
                                                                </span>
                                                            </p>
                                                </div>
                                                <% }) %>
                                                    <% } %>
                                                        <% }) %>
                                                            <% } else { %>
                                                                <div
                                                                    class="col-span-2 text-center py-12 bg-gray-50 rounded-lg border border-gray-200">
                                                                    <i data-lucide="map-pin"
                                                                        class="w-12 h-12 mx-auto text-gray-400 mb-4"></i>
                                                                    <p class="text-gray-600 mb-4">No addresses found.
                                                                        Add your first address!</p>
                                                                    <button
                                                                        onclick="window.location.href='/profile/address/add'"
                                                                        class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
                                                                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                                                        Add New Address
                                                                    </button>
                                                                </div>
                                                                <% } %>
                            </div>
                    </section>
                    <section id="referrals" class="mb-10 section-card">
                        <div class="bg-white shadow-md rounded-xl p-6">
                            <h2 class="text-2xl font-semibold mb-6 text-black flex items-center">
                                <i data-lucide="users" class="w-6 h-6 mr-2 text-indigo-600"></i>
                                My Referrals
                            </h2>

                            <!-- Referral Code Card -->
                            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 mb-8">
                                <h3 class="text-xl font-semibold mb-2 text-black">Your Referral Code</h3>
                                <p class="text-sm mb-4 text-black">Share this code with friends to earn rewards!</p>
                                <div class="flex items-center">
                                    <div class="bg-white bg-opacity-20 rounded-lg p-3 flex-grow mr-2">
                                        <p class="text-xl font-mono text-center select-all text-black">
                                            <%= user.referralCode %>
                                        </p>
                                    </div>
                                    <button id="copyReferralBtn"
                                        class="bg-white text-black hover:bg-indigo-50 font-medium py-3 px-4 rounded-lg transition-colors duration-200">
                                        <i data-lucide="copy" class="w-5 h-5"></i>
                                    </button>
                                </div>
                                <div class="mt-5 grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                                        <p class="text-sm text-black">Total Referrals</p>
                                        <p class="text-2xl font-bold text-black">
                                            <%= user.referralCount || 0 %>
                                        </p>
                                    </div>
                                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                                        <p class="text-sm text-black">Total Earned</p>
                                        <p class="text-2xl font-bold text-black">₹<%= totalReferralEarnings || 0 %>
                                        </p>
                                    </div>
                                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                                        <p class="text-sm text-black">Reward Per Referral</p>
                                        <p class="text-2xl font-bold text-black">₹<%= referralReward || 100 %>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Share Referral Links -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold mb-4 text-gray-700">Share Your Referral Link</h3>
                                <div class="flex flex-wrap gap-2">
                                    <a id="whatsappShareBtn" href="#"
                                        class="inline-flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                        <i class="fab fa-whatsapp mr-2 text-lg"></i> WhatsApp
                                    </a>
                                    <a id="facebookShareBtn" href="#"
                                        class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        <i class="fab fa-facebook-f mr-2"></i> Facebook
                                    </a>
                                    <a id="twitterShareBtn" href="#"
                                        class="inline-flex items-center px-4 py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500">
                                        <i class="fab fa-twitter mr-2"></i> Twitter
                                    </a>
                                    <a id="emailShareBtn" href="#"
                                        class="inline-flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                        <i class="fa fa-envelope mr-2"></i> Email
                                    </a>
                                </div>
                            </div>

                            
                        </div>
                    </section>
                </div>
            </div>
            </div>
        </main>

        <%- include("../../views/partials/user/footer") %>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    lucide.createIcons();
                });

                const userReferralCode = '<%= user.referralCode %>';
                const siteUrl = '<%= siteUrl %>';

                function setActiveNavLink() {
                    const sections = document.querySelectorAll('section');
                    const navLinks = document.querySelectorAll('.nav-link');

                    let currentSection = 'overview';

                    sections.forEach(section => {
                        const sectionTop = section.offsetTop;
                        const sectionHeight = section.clientHeight;
                        if (window.scrollY >= (sectionTop - 200)) {
                            currentSection = section.getAttribute('id');
                        }
                    });

                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${currentSection}`) {
                            link.classList.add('active');
                        }
                    });
                }

                window.addEventListener('scroll', setActiveNavLink);
                window.addEventListener('load', setActiveNavLink);

                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                            window.scrollTo({
                                top: target.offsetTop - 100,
                                behavior: 'smooth'
                            });
                        }
                    });
                });

                async function cancelOrder(orderId) {
                    Swal.fire({
                        title: 'Cancel Order',
                        text: 'Are you sure you want to cancel this order?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#4F46E5',
                        cancelButtonColor: '#EF4444',
                        confirmButtonText: 'Yes, cancel it!',
                        cancelButtonText: 'No, keep it'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const response = await fetch(`/api/orders/${orderId}/cancel`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                });

                                if (response.ok) {
                                    Swal.fire({
                                        title: 'Cancelled!',
                                        text: 'Your order has been cancelled successfully.',
                                        icon: 'success',
                                        confirmButtonColor: '#4F46E5'
                                    }).then(() => {
                                        window.location.reload();
                                    });
                                } else {
                                    const errorData = await response.json();
                                    Swal.fire({
                                        title: 'Error!',
                                        text: errorData.message || 'Failed to cancel order. Please try again.',
                                        icon: 'error',
                                        confirmButtonColor: '#4F46E5'
                                    });
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                Swal.fire({
                                    title: 'Error!',
                                    text: 'An error occurred while cancelling the order.',
                                    icon: 'error',
                                    confirmButtonColor: '#4F46E5'
                                });
                            }
                        }
                    });
                }

                async function blockAddress(docId, addressId) {
                    Swal.fire({
                        title: 'Block Address',
                        text: 'Are you sure you want to block this address?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#4F46E5',
                        cancelButtonColor: '#EF4444',
                        confirmButtonText: 'Yes, block it!',
                        cancelButtonText: 'No, keep it'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const response = await fetch(`/address/block/${docId}/${addressId}`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                });

                                const data = await response.json();

                                if (response.ok) {
                                    Swal.fire({
                                        title: 'Blocked!',
                                        text: 'Your address has been blocked successfully.',
                                        icon: 'success',
                                        confirmButtonColor: '#4F46E5'
                                    }).then(() => {
                                        window.location.reload();
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Error!',
                                        text: data.message || 'Failed to block address. Please try again.',
                                        icon: 'error',
                                        confirmButtonColor: '#4F46E5'
                                    });
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                Swal.fire({
                                    title: 'Error!',
                                    text: 'An error occurred while blocking the address.',
                                    icon: 'error',
                                    confirmButtonColor: '#4F46E5'
                                });
                            }
                        }
                    });
                }
                async function unblockAddress(docId, addressId) {
                    Swal.fire({
                        title: 'Unblock Address',
                        text: 'Are you sure you want to unblock this address?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#4F46E5',
                        cancelButtonColor: '#EF4444',
                        confirmButtonText: 'Yes, unblock it!',
                        cancelButtonText: 'No, leave it blocked'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const response = await fetch(`/address/unblock/${docId}/${addressId}`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                });

                                const data = await response.json();

                                if (response.ok) {
                                    Swal.fire({
                                        title: 'Unblocked!',
                                        text: 'Your address has been unblocked successfully.',
                                        icon: 'success',
                                        confirmButtonColor: '#4F46E5'
                                    }).then(() => {
                                        window.location.reload();
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Error!',
                                        text: data.message || 'Failed to unblock address. Please try again.',
                                        icon: 'error',
                                        confirmButtonColor: '#4F46E5'
                                    });
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                Swal.fire({
                                    title: 'Error!',
                                    text: 'An error occurred while unblocking the address.',
                                    icon: 'error',
                                    confirmButtonColor: '#4F46E5'
                                });
                            }
                        }
                    });
                }
                document.addEventListener('DOMContentLoaded', function () {
                    const copyReferralBtn = document.getElementById('copyReferralBtn');
                    if (copyReferralBtn) {
                        copyReferralBtn.addEventListener('click', function () {
                            navigator.clipboard.writeText(userReferralCode).then(function () {
                                Swal.fire({
                                    title: 'Copied!',
                                    text: 'Referral code copied to clipboard',
                                    icon: 'success',
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 3000
                                });
                            }, function (err) {
                                console.error('Could not copy text: ', err);
                                Swal.fire({
                                    title: 'Error!',
                                    text: 'Failed to copy referral code',
                                    icon: 'error',
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 3000
                                });
                            });
                        });
                    }
                });
                document.addEventListener('DOMContentLoaded', function () {
                    const referralCode = userReferralCode;
                    const referralUrl = `${siteUrl}/register?ref=${referralCode}`;

                    const whatsappBtn = document.getElementById('whatsappShareBtn');
                    if (whatsappBtn) {
                        const whatsappText = `Shop with my referral code ${referralCode} at TimelessEdge and get a discount on your first order!`;
                        whatsappBtn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.open(`https://wa.me/?text=${encodeURIComponent(whatsappText + ' ' + referralUrl)}`, '_blank');
                        });
                    }

                    const facebookBtn = document.getElementById('facebookShareBtn');
                    if (facebookBtn) {
                        facebookBtn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralUrl)}`, '_blank');
                        });
                    }

                    const twitterBtn = document.getElementById('twitterShareBtn');
                    if (twitterBtn) {
                        const tweetText = `Join TimelessEdge with my referral code ${referralCode} and get amazing discounts!`;
                        twitterBtn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}&url=${encodeURIComponent(referralUrl)}`, '_blank');
                        });
                    }

                    const emailBtn = document.getElementById('emailShareBtn');
                    if (emailBtn) {
                        const emailSubject = 'Join TimelessEdge with my referral code';
                        const emailBody = `Use my referral code ${referralCode} to get a discount on your first order at TimelessEdge! Sign up here: ${referralUrl}`;
                        emailBtn.addEventListener('click', function (e) {
                            e.preventDefault();
                            window.location.href = `mailto:?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
                        });
                    }
                });


                function debugReferralData() {
                    console.log('Referral Code:', userReferralCode);
                    console.log('Site URL:', siteUrl);
                    console.log('Referral Transactions:', document.querySelectorAll('tbody tr').length);
                    console.log('Total Referral Earnings:', document.querySelector('.bg-white.bg-opacity-20:nth-child(2) .text-2xl').textContent);
                }


            </script>
</body>

</html>